import{g as k,h as R,i as B,j as P,k as p,p as U,l as O,m as j,n as I,q as E,s as Q,v as G,w as $,x as H,y as K,z as L,d as M,A as T,u as J,B as W,C as X,o as w,D as V,E as y,a as b,Q as _,F,G as Y,H as Z,b as ee}from"./index.182d076f.js";const N=k({name:"QCardSection",props:{tag:{type:String,default:"div"},horizontal:Boolean},setup(t,{slots:o}){const u=R(()=>`q-card__section q-card__section--${t.horizontal===!0?"horiz row no-wrap":"vert"}`);return()=>B(t.tag,{class:u.value},P(o.default))}}),te=k({name:"QForm",props:{autofocus:Boolean,noErrorFocus:Boolean,noResetFocus:Boolean,greedy:Boolean,onSubmit:Function},emits:["reset","validation-success","validation-error"],setup(t,{slots:o,emit:u}){const a=E(),i=p(null);let d=0;const s=[];function g(e){const r=[],q=typeof e=="boolean"?e:t.noErrorFocus!==!0,z=++d,C=(m,l)=>{u("validation-"+(m===!0?"success":"error"),l)};for(let m=0;m<s.length;m++){const l=s[m],h=l.validate();if(typeof h.then=="function")r.push(h.then(v=>({valid:v,comp:l}),v=>({valid:!1,comp:l,err:v})));else if(h!==!0){if(t.greedy===!1)return C(!1,l),q===!0&&typeof l.focus=="function"&&l.focus(),Promise.resolve(!1);r.push({valid:!1,comp:l})}}return r.length===0?(C(!0),Promise.resolve(!0)):Promise.all(r).then(m=>{const l=m.filter(D=>D.valid!==!0);if(l.length===0)return z===d&&C(!0),!0;const{valid:h,comp:v,err:A}=l[0];return z===d&&(A!==void 0&&console.error(A),C(!1,v),q===!0&&h!==!0&&typeof v.focus=="function"&&v.focus()),!1})}function f(){d++,s.forEach(e=>{typeof e.resetValidation=="function"&&e.resetValidation()})}function x(e){e!==void 0&&Q(e);const r=d+1;g().then(q=>{r===d&&q===!0&&(t.onSubmit!==void 0?u("submit",e):e!==void 0&&e.target!==void 0&&typeof e.target.submit=="function"&&e.target.submit())})}function S(e){e!==void 0&&Q(e),u("reset"),G(()=>{f(),t.autofocus===!0&&t.noResetFocus!==!0&&n()})}function n(){$(()=>{if(i.value===null)return;const e=i.value.querySelector("[autofocus], [data-autofocus]")||Array.prototype.find.call(i.value.querySelectorAll("[tabindex]"),r=>r.tabIndex>-1);e!=null&&e.focus({preventScroll:!0})})}U(H,{bindComponent(e){s.push(e)},unbindComponent(e){const r=s.indexOf(e);r>-1&&s.splice(r,1)}});let c=!1;return O(()=>{c=!0}),j(()=>{c===!0&&t.autofocus===!0&&n()}),I(()=>{t.autofocus===!0&&n()}),Object.assign(a.proxy,{validate:g,resetValidation:f,submit:x,reset:S,focus:n,getValidationComponents:()=>s}),()=>B("form",{class:"q-form",ref:i,onSubmit:x,onReset:S},P(o.default))}}),ae=k({name:"QCard",props:{...K,tag:{type:String,default:"div"},square:Boolean,flat:Boolean,bordered:Boolean},setup(t,{slots:o}){const u=E(),a=L(t,u.proxy.$q),i=R(()=>"q-card"+(a.value===!0?" q-card--dark q-dark":"")+(t.bordered===!0?" q-card--bordered":"")+(t.square===!0?" q-card--square no-border-radius":"")+(t.flat===!0?" q-card--flat no-shadow":""));return()=>B(t.tag,{class:i.value},P(o.default))}}),oe=ee("div",{class:"text-h6 text-weight-bolder"},"Login Page",-1),ne=M({__name:"login",setup(t){const o=T(),u=J(),a=p(0),i=p(null),d=p(null),s=p(null),g=p(!1),f=p(!1),x=W({button:["Get code","Confirm Code","Sign in"]}),S=async()=>{try{if(f.value=!0,a.value===0&&await o.getCode(i.value),a.value===1&&(await o.confirmCode(s.value)).response._==="error"&&(s.value=null,a.value--,g.value=!0),a.value===2){if(await o.signIn(d.value),await o.getAuthState()==="authorizationStateReady")return o.isAuth=!0,u.push("/");a.value--}a.value++}catch(n){f.value=!1,console.log(n)}finally{f.value=!1}};return I(async()=>{if(await o.getAuthState()==="authorizationStateReady")return o.isAuth=!0,u.push("/")}),X.on("updateAuthorizationState",n=>{n.update.authorizationState._==="authorizationStateReady"&&u.push("/")}),(n,c)=>(w(),V(Z,{padding:"",class:"flex flex-center"},{default:y(()=>[b(ae,null,{default:y(()=>[b(N,null,{default:y(()=>[oe]),_:1}),b(N,null,{default:y(()=>[b(te,{onSubmit:S},{default:y(()=>[b(_,{modelValue:i.value,"onUpdate:modelValue":c[0]||(c[0]=e=>i.value=e),outlined:"",label:"Phone Number (628xxxxxxx)","stack-label":"",disable:a.value>0,"lazy-rules":"",rules:[e=>e&&e.length||"Phone Number is required",e=>e&&e.length<=15||"Phone Number maximum 15 character",e=>e&&!isNaN(e)||"Phone Number must be a number"]},null,8,["modelValue","disable","rules"]),a.value>0?(w(),V(_,{key:0,modelValue:s.value,"onUpdate:modelValue":c[1]||(c[1]=e=>s.value=e),outlined:"",label:"Code (Send to telegram message)","stack-label":"",class:"q-mt-sm",disable:a.value>1,"lazy-rules":"",rules:[e=>e&&e.length||"Code is required",e=>e&&!g.value||"Invalid Code"]},null,8,["modelValue","disable","rules"])):F("",!0),a.value>1?(w(),V(_,{key:1,modelValue:d.value,"onUpdate:modelValue":c[2]||(c[2]=e=>d.value=e),outlined:"",label:"Password (Optional if you set your account password)","stack-label":"",class:"q-mt-sm",type:"password",disable:a.value>2},null,8,["modelValue","disable"])):F("",!0),b(Y,{"no-caps":"",unelevated:"",label:x.button[a.value],color:"primary",class:"full-width q-mt-lg",loading:f.value,type:"submit"},null,8,["label","loading"])]),_:1})]),_:1})]),_:1})]),_:1}))}});export{ne as default};
